<p align="center">
  <img src="https://github.com/kamil1403/otus_LVM-1/blob/main/screenshots/lvm.jpg" alt="RAID Banner" width="800">
</p>

<h1 align="center">otus_ZFS</h1>
<p align="center">–î–∞—Ç–∞: 19-05-2025<br>–ê–≤—Ç–æ—Ä: Kamil Ibragimov</p>

## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: —Ä–∞–±–æ—Ç–∞ —Å LVM
–ó–∞–¥–∞–Ω–∏–µ:   
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Å –Ω–∞–∏–ª—É—á—à–∏–º —Å–∂–∞—Ç–∏–µ–º:   
‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–∂–∞—Ç–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç zfs (gzip, zle, lzjb, lz4);   
‚Ä¢ C–æ–∑–¥–∞—Ç—å 4 —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –∫–∞–∂–¥–æ–π –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–∂–∞—Ç–∏—è;   
‚Ä¢ –î–ª—è —Å–∂–∞—Ç–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–±–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª, –ª–∏–±–æ –≥—Ä—É–ø–ø—É —Ñ–∞–π–ª–æ–≤.   
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞ –∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–º–∞–Ω–¥—ã zfs import —Å–æ–±—Ä–∞—Ç—å pool ZFS.   
–ö–æ–º–∞–Ω–¥–∞–º–∏ zfs –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:     
‚Ä¢ –†–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞;   
‚Ä¢ –¢–∏–ø pool;   
‚Ä¢ –ó–Ω–∞—á–µ–Ω–∏–µ recordsize;   
‚Ä¢ –ö–∞–∫–æ–µ —Å–∂–∞—Ç–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è;   
‚Ä¢ –ö–∞–∫–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.   
3. –†–∞–±–æ—Ç–∞ —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏:   
‚Ä¢ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏;   
‚Ä¢ –°–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ. zfs receive;   
‚Ä¢ –ù–∞–π—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–µ secret_message.   

–†–µ–∑—É–ª—å—Ç–∞—Ç:   
‚Ä¢ –°–æ–∑–¥–∞–ª Physical Volume, Volume Group –∏ Logical Volume. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–º. –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ ["lvm_create"](https://github.com/kamil1403/otus_LVM-1/blob/main/screenshots/lvm_create.png)  
‚Ä¢ –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–ª —Ç–æ–º –∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –≤ –∫–∞—Ç–∞–ª–æ–≥ /lvm. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–º. –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ ["mkfs.ext4"](https://github.com/kamil1403/otus_LVM-1/blob/main/screenshots/mkfs.ext4.png)  
‚Ä¢ –†–∞—Å—à–∏—Ä–∏–ª —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∑–∞ —Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ –¥–∏—Å–∫–∞ –Ω–∞ 5Gb. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–º. –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ ["resize"](https://github.com/kamil1403/otus_LVM-1/blob/main/screenshots/resize.png) 



## üß≠ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã LVM](#pvl)
- [‚öôÔ∏è –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã](#ext4)
- [‚úÇÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã](#resize)

---

<a id="pvl"></a>
## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ Physical Volume, Volume Group –∏ Logical Volume

```bash
# LVM (Logical Volume Manager) ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏—Å–∫–∞–º–∏ –≤ Linux, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –≥–∏–±–∫–æ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–æ—Å–∏—Ç–µ–ª—è—Ö   
# LVM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è:
# 1. PV (Physical Volume) ‚Äî —ç—Ç–æ "—Å—ã—Ä–æ–π" –¥–∏—Å–∫ –∏–ª–∏ —Ä–∞–∑–¥–µ–ª, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –ø–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ LVM   
pvcreate /dev/sdb
# 2. VG (Volume Group) ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤ –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ PV   
vgcreate otus /dev/sdb
# 3. LV ‚Äî —ç—Ç–æ "–∫—É—Å–æ–∫" –∏–∑ –≥—Ä—É–ø–ø—ã VG, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª, —Ç–æ–ª—å–∫–æ –≥–∏–±—á–µ   
lvcreate -L 10G -n test otus
# –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ–º–∞ –Ω–∞ 80% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞   
lvcreate -l+80%FREE -n test otus   
# –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ–º–∞   
lvremove /dev/otus/test   
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LVM   
# –ü–æ–¥—Ä–æ–±–Ω–æ:  
pvdispaly 
vgdisplay   
lvdisplay   
# –ö—Ä–∞—Ç–∫–æ:   
pvs   
vgs   
lvs   
```

---

<a id="ext4"></a>
## ‚öôÔ∏è –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ–º–∞
mkfs.ext4 /dev/otus/test
# –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ–º–∞
mkdir /lvm
mount /dev/otus/test /lvm
```

---

<a id="resize"></a>
## ‚úÇÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ —Å–∂–∞—Ç–∏—è –≤ ZFS

## üß± –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—É–ª–∞

–°–æ–∑–¥–∞—ë–º –ø—É–ª ZFS —Å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

```bash
zpool create tmp_pool mirror /dev/vdb /dev/vdd -f
```

–ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –ø—É–ª–∞:

```bash
zpool status
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º

–°–æ–∑–¥–∞—ë–º —Ç—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ ZFS-—Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã:

```bash
zfs create tmp_pool/zfs_dedup
zfs create tmp_pool/zfs_compress
zfs create tmp_pool/zfs_plain
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–í–∫–ª—é—á–∞–µ–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é:

```bash
zfs set dedup=on tmp_pool/zfs_dedup
```

–í–∫–ª—é—á–∞–µ–º —Å–∂–∞—Ç–∏–µ:

```bash
zfs set compression=on tmp_pool/zfs_compress
```

–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ `zfs_plain` –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

---

## üß™ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –∏–∑ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å—Ç—Ä–æ–∫ (—Ö–æ—Ä–æ—à–æ —Å–∂–∏–º–∞–µ—Ç—Å—è –∏ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è):

```bash
mkdir test_data && cd test_data
yes "REPEATME" | head -c 50M > file_repeat.txt
```

---

## üìù –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã

```bash
cp file_repeat.txt /tmp_pool/zfs_plain/
cp file_repeat.txt /tmp_pool/zfs_dedup/
cp file_repeat.txt /tmp_pool/zfs_compress/
```

---

## üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞:

```bash
zfs list
```

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è:

```bash
zfs get compressratio
```

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

```bash
zfs get dedup
zpool list
```

---

## ‚ö†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞—ë–º –Ω–µ—Å–∂–∏–º–∞–µ–º—ã–π —Ñ–∞–π–ª:

```bash
dd if=/dev/urandom of=randfile.bin bs=1M count=50
```

–ö–æ–ø–∏—Ä—É–µ–º –µ–≥–æ –≤–æ –≤—Å–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã:

```bash
cp randfile.bin /tmp_pool/zfs_plain/
cp randfile.bin /tmp_pool/zfs_dedup/
cp randfile.bin /tmp_pool/zfs_compress/
```

–°–Ω–æ–≤–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º:

```bash
zfs list
zfs get compressratio
zfs get dedup
```

---

## üßº –û—á–∏—Å—Ç–∫–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)

```bash
zfs destroy tmp_pool/zfs_dedup
zfs destroy tmp_pool/zfs_compress
zfs destroy tmp_pool/zfs_plain
rm -rf test_data randfile.bin
```

---

## üìå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–ª–æ–∫–æ–≤ –∏ —Ç—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤).
- **–°–∂–∞—Ç–∏–µ** —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∏ –º–æ–∂–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –Ω–∞ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö.

---
```

---
